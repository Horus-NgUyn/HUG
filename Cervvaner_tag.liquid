{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-testimonials-{{ ai_gen_id }} {
    max-width: 1200px;
    margin: 0 auto;
    padding: 60px 24px;
  }

  .ai-testimonials-grid-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 30px;
  }

  .ai-testimonial-card-{{ ai_gen_id }} {
    position: relative;
    background-color: {{ block.settings.card_background }};
    border-radius: 30px;
    padding: {{ block.settings.avatar_size | plus: 20 }}px 24px 24px;
    min-height: 320px;
    box-shadow: 0 4px 20px rgba(28,26,29,0.08);
    overflow: hidden;
    /* Tạo hiệu ứng cắt góc trên trái cho avatar với border-radius */
    clip-path: polygon(
      {{ block.settings.avatar_size | plus: 10 }}px 0,
      calc(100% - 30px) 0,
      100% 30px,
      100% calc(100% - 30px),
      calc(100% - 30px) 100%,
      30px 100%,
      0 calc(100% - 30px),
      0 {{ block.settings.avatar_size | plus: 10 }}px
    );
  }

  /* Avatar nằm trong vùng bị cắt */
  .ai-testimonial-avatar-{{ ai_gen_id }} {
    position: absolute;
    top: 5px;
    left: 5px;
    width: {{ block.settings.avatar_size }}px;
    height: {{ block.settings.avatar_size }}px;
    border: 4px solid #fff;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 4px 15px rgba(28,26,29,0.15);
    background-color: #fff;
    z-index: 10;
  }

  /* Header section chứa title và subtitle - nằm cùng hàng với avatar */
  .ai-testimonial-header-{{ ai_gen_id }} {
    position: absolute;
    top: 24px;
    left: calc({{ block.settings.avatar_size }}px + 20px);
    right: 24px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    justify-content: center;
    min-height: {{ block.settings.avatar_size }}px;
  }

  .ai-testimonial-content-{{ ai_gen_id }} {
    margin-top: {{ block.settings.avatar_size | plus: 20 }}px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .ai-testimonial-author-{{ ai_gen_id }} {
    font-size: {{ block.settings.author_size }}px;
    font-weight: 600;
    color: {{ block.settings.author_color }};
    margin: 0;
  }

  .ai-testimonial-role-{{ ai_gen_id }} {
    font-size: {{ block.settings.role_size }}px;
    color: {{ block.settings.role_color }};
    margin: 0;
    opacity: 0.8;
  }

  .ai-testimonial-text-{{ ai_gen_id }} {
    position: relative;
    font-size: {{ block.settings.text_size }}px;
    color: {{ block.settings.text_color }};
    margin: 0;
    line-height: 1.6;
  }

  .ai-testimonial-text-{{ ai_gen_id }}::before {
    content: '“';
    position: absolute;
    top: -12px;
    left: -20px;
    font-size: 48px;
    color: rgba(0,0,0,0.1);
  }

  .ai-testimonial-rating-{{ ai_gen_id }} {
    display: flex;
    gap: 4px;
    margin-top: auto;
  }

  .ai-testimonial-star-{{ ai_gen_id }} {
    width: 20px;
    height: 20px;
    fill: {{ block.settings.role_color }};
  }

  @media screen and (max-width: 1199px) {
    .ai-testimonials-grid-{{ ai_gen_id }} {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media screen and (max-width: 749px) {
    .ai-testimonials-grid-{{ ai_gen_id }} {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    .ai-testimonial-card-{{ ai_gen_id }} {
      min-height: 280px;
      padding: {{ block.settings.avatar_size | plus: 20 }}px 20px 20px;
    }
    
    .ai-testimonial-header-{{ ai_gen_id }} {
      top: 20px;
      left: calc({{ block.settings.avatar_size }}px + 15px);
      right: 20px;
    }
    
    .ai-testimonial-avatar-{{ ai_gen_id }} {
      left: 5px;
      top: 5px;
    }
    
    .ai-testimonial-content-{{ ai_gen_id }} {
      margin-top: {{ block.settings.avatar_size | plus: 15 }}px;
    }
  }
{% endstyle %}

<div class="ai-testimonials-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  {% if block.settings.heading != blank %}
    <h2 class="ai-testimonials-heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
  {% endif %}

  <div class="ai-testimonials-grid-{{ ai_gen_id }}">
    {% for i in (1..3) %}
      {% liquid
        assign key_text = 'testimonial_' | append: i | append: '_text'
        assign key_author = 'testimonial_' | append: i | append: '_author'
        assign key_role = 'testimonial_' | append: i | append: '_role'
        assign key_avatar = 'testimonial_' | append: i | append: '_avatar'
        assign text = block.settings[key_text]
        assign author = block.settings[key_author]
        assign role = block.settings[key_role]
        assign avatar = block.settings[key_avatar]
      %}
      {% if text or author %}
        <div class="ai-testimonial-card-{{ ai_gen_id }}">
          {% if avatar %}
            <img
              src="{{ avatar | image_url: width: block.settings.avatar_size }}"
              alt="{{ author | escape }}"
              class="ai-testimonial-avatar-{{ ai_gen_id }}"
              loading="lazy"
              width="{{ block.settings.avatar_size }}"
              height="{{ block.settings.avatar_size }}"
            >
          {% endif %}
          
          <div class="ai-testimonial-header-{{ ai_gen_id }}">
            {% if author %}<p class="ai-testimonial-author-{{ ai_gen_id }}">{{ author }}</p>{% endif %}
            {% if role %}<p class="ai-testimonial-role-{{ ai_gen_id }}">{{ role }}</p>{% endif %}
          </div>
          
          <div class="ai-testimonial-content-{{ ai_gen_id }}">
            {% if text %}<p class="ai-testimonial-text-{{ ai_gen_id }}">{{ text }}</p>{% endif %}
            <div class="ai-testimonial-rating-{{ ai_gen_id }}">
              {% for _ in (1..5) %}
                <svg class="ai-testimonial-star-{{ ai_gen_id }}" viewBox="0 0 24 24">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
              {% endfor %}
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</div>


{% schema %}
{
  "name": "What Our Client Says",
  "settings": [
    {
      "type": "header",
      "content": "Heading Settings"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading text",
      "default": "What Our Client Says"
    },
    {
      "type": "font_picker",
      "id": "heading_font",
      "label": "Heading font",
      "default": "serif"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 24,
      "max": 72,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 50
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#1c1a1d"
    },
    {
      "type": "header",
      "content": "Card Design"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background color",
      "default": "#fdf2f8"
    },
    {
      "type": "range",
      "id": "avatar_size",
      "min": 80,
      "max": 140,
      "step": 4,
      "unit": "px",
      "label": "Avatar size",
      "default": 100
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Testimonial text color",
      "default": "#707070"
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 14,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 16
    },
    {
      "type": "color",
      "id": "author_color",
      "label": "Author name color",
      "default": "#1c1a1d"
    },
    {
      "type": "range",
      "id": "author_size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Author name size",
      "default": 18
    },
    {
      "type": "color",
      "id": "role_color",
      "label": "Role/position color",
      "default": "#c4c4c4"
    },
    {
      "type": "range",
      "id": "role_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Role size",
      "default": 14
    },
    {
      "type": "header",
      "content": "Testimonial 1"
    },
    {
      "type": "text",
      "id": "testimonial_1_author",
      "label": "Tên tác giả",
      "default": "Michael T, 52"
    },
    {
      "type": "text",
      "id": "testimonial_1_role",
      "label": "Vị trí/nghề nghiệp",
      "default": "Software Engineer"
    },
    {
      "type": "textarea",
      "id": "testimonial_1_text",
      "label": "Nội dung testimonial",
      "default": "After years of cooking long hours, my wife and I never cooked well and ate. I tried everything to make cooking easier. This machine has changed that. I am finally feeling confident when it comes to home cooking and making breakfast we both love. It has helped immensely with so much less work!"
    },
    {
      "type": "image_picker",
      "id": "testimonial_1_avatar",
      "label": "Ảnh đại diện (chọn từ Shopify Media Library)",
      "info": "Chọn ảnh từ thư viện media của Shopify. Kích thước khuyến nghị: 200x200px"
    },
    {
      "type": "header",
      "content": "Testimonial 2"
    },
    {
      "type": "text",
      "id": "testimonial_2_author",
      "label": "Tên tác giả", 
      "default": "Lisa P, 35"
    },
    {
      "type": "text",
      "id": "testimonial_2_role",
      "label": "Vị trí/nghề nghiệp",
      "default": "Mom of Two"
    },
    {
      "type": "textarea",
      "id": "testimonial_2_text",
      "label": "Nội dung testimonial",
      "default": "You completely for the easy dinner plans! I've been able to work in the single kitchen, buy household items without warning. This solution has become my favorite thing to manage small busy night I set on the current, and I'm so happy for instant shopping faster. Simply love."
    },
    {
      "type": "image_picker",
      "id": "testimonial_2_avatar",
      "label": "Ảnh đại diện (chọn từ Shopify Media Library)",
      "info": "Chọn ảnh từ thư viện media của Shopify. Kích thước khuyến nghị: 200x200px"
    },
    {
      "type": "header",
      "content": "Testimonial 3"
    },
    {
      "type": "text",
      "id": "testimonial_3_author",
      "label": "Tên tác giả",
      "default": "David K, 61"
    },
    {
      "type": "text",
      "id": "testimonial_3_role",
      "label": "Vị trí/nghề nghiệp", 
      "default": "Retired Firefighter"
    },
    {
      "type": "textarea",
      "id": "testimonial_3_text",
      "label": "Nội dung testimonial",
      "default": "After working in all outdoors opened coaching us, I especially in the quick deal recipe book. I wasn't super tough cooking with a bread stovetop kitchen. This set has never let me process cooking and have process double to just nights. I love to enjoy allocating and I believe on very active and draw lessons. Team high lives."
    },
    {
      "type": "image_picker",
      "id": "testimonial_3_avatar",
      "label": "Ảnh đại diện (chọn từ Shopify Media Library)",
      "info": "Chọn ảnh từ thư viện media của Shopify. Kích thước khuyến nghị: 200x200px"
    }
  ],
  "presets": [
    {
      "name": "What Our Client Says",
      "settings": {}
    }
  ]
}
{% endschema %}
